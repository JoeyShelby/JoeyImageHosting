<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File List</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
   <style>
        /* 样式化方形控件 */
        .file-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        /*横向控件*/
        .horizontal-container {
            display: flex;
            flex-wrap: wrap;
        }

        .file-group {
            margin-bottom: 20px;
        }

        .file-box {
            position: relative;
            width: 200px;
            height: 200px;
            background-color: #f0f0f0;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-right: 10px;
            margin-bottom: 10px;
            text-align: center;
            cursor: pointer;
        }

        .file-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .file-box:hover .file-info {
            display: block;
        }
          body {
            margin: 0;
            font-family: 'Arial', sans-serif;
        }

        header {
            background-color: #333;
            padding: 10px;
            text-align: center;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>File List</h1>
    </header>
    <div id="fileList"></div>

    <script>
        // 从后端获取 JSON 数据
        fetch('/list_files')
            .then(response => response.json())
            .then(data => {
                // 打印获取到的 JSON 数据
                console.log('JSON data:', data);

                // 调用渲染函数
                renderFileList(data.files_info);
            })
            .catch(error => console.error('Error fetching data:', error));


        // 渲染文件列表
        function renderFileList(filesInfo) {
            const fileListContainer = document.getElementById('fileList');

            if (!filesInfo || !Array.isArray(filesInfo)) {
                console.error('Invalid data format');
                return;
            }

            // 按日期分组的逻辑
            const filesByDate = {};
            filesInfo.forEach(fileInfo => {
                const date = fileInfo.upload_date;
                if (!filesByDate[date]) {
                    filesByDate[date] = [];
                }
                filesByDate[date].push(fileInfo);
            });

            console.log(filesByDate)

            // 清空容器
            fileListContainer.innerHTML = '';

            // 遍历日期分组
            Object.keys(filesByDate).forEach(date => {
                const fileGroup = document.createElement('div');
                fileGroup.classList.add('file-group');

                // 添加日期标题
                const dateHeader = document.createElement('h2');
                dateHeader.textContent = date;
                fileGroup.appendChild(dateHeader);

                // 创建横向容器，横向显示每个日期分组内的图片
                const horizontalContainer = document.createElement('div');
                horizontalContainer.classList.add('horizontal-container');
                fileGroup.appendChild(horizontalContainer);

                // 遍历日期内的文件
                filesByDate[date].forEach(fileInfo => {
                    const fileBox = document.createElement('div');
                    fileBox.classList.add('file-box');

                    // 在控件上添加悬停效果
                    fileBox.addEventListener('mouseover', () => showFileInfo(fileInfo));

                    // 在控件上添加点击事件，将文件的url保存到剪贴板
                    fileBox.addEventListener('click', () => copyToClipboard(getWebsitePath() + fileInfo.filename));

                    // 创建图片元素
                    const imgElement = document.createElement('img');
                    imgElement.src = getWebsitePath() + fileInfo.filename;
                    imgElement.alt = fileInfo.filename; // 添加图片的替代文本
                    imgElement.style.width = '100%'; // 使图片充满整个容器

                    const fileInfoElement = document.createElement('div');
                    fileInfoElement.classList.add('file-info');
                    fileInfoElement.textContent = `${fileInfo.filename}\n${fileInfo.size}`;

                    fileBox.appendChild(imgElement);
                    fileBox.appendChild(fileInfoElement);
                    horizontalContainer.appendChild(fileBox);
                });

                fileListContainer.prepend(fileGroup);
            });
        }

        // 显示文件信息
        function showFileInfo(fileInfo) {
            console.log(`File: ${fileInfo.filename}, Size: ${fileInfo.size}, Upload Date: ${fileInfo.upload_date}`);
        }

        // 获取当前页面的网站路径
        function getWebsitePath() {
            // 获取当前页面的完整 URL
            const currentUrl = window.location.href;

            // 提取网站路径部分
            const pathArray = currentUrl.split('/');
            return pathArray[0] + '//' + pathArray[2] + '/';
        }


        // 复制文件名到剪贴板
        function copyToClipboard(filename) {
            const clipboard = new ClipboardJS('.file-box', {
                text: function() {
                    return filename;
                }
            });

            clipboard.on('success', function(e) {
                console.log(`Copied to clipboard: ${e.text}`);
                clipboard.destroy();
            });

            clipboard.on('error', function(e) {
                console.error('Unable to copy to clipboard', e);
                clipboard.destroy();
            });

            clipboard.onClick({ trigger: true });
        }
    </script>
</body>
</html>
